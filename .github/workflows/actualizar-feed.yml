name: Actualizar noticias diarias

on:
  schedule:
    - cron: "0 7 * * *"  # Se ejecuta cada d√≠a a las 08:00 hora de Madrid (UTC+1)
  workflow_dispatch:      # Permite ejecutarlo manualmente tambi√©n

jobs:
  actualizar-feed:
    runs-on: ubuntu-latest

    steps:
      - name: Clonar repositorio
        uses: actions/checkout@v4

      - name: Configurar zona horaria
        run: sudo timedatectl set-timezone Europe/Madrid

      - name: Generar archivo XML actualizado
        run: |
          FECHA=$(date +"%d/%m/%Y")
          PUBDATE=$(date -R)

          cat > docs/noticias-diarias.xml.txt <<EOF
<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0">
  <channel>
    <title>Noticias Diarias - Espa√±a</title>
    <link>https://edekmm.github.io/Noticias-diarias/docs/noticias-diarias.xml.txt</link>
    <description>Noticias destacadas en Espa√±a, Madrid, econom√≠a mundial, econom√≠a espa√±ola, construcci√≥n y Grupo ACS / Dragados.</description>
    <language>es-es</language>

    <item>
      <title>Noticias del d√≠a \$FECHA</title>
      <description><![CDATA[
      üá™üá∏ <b>Noticias en Espa√±a:</b><br>
      - Titular nacional del d√≠a \$FECHA<br><br>

      üèôÔ∏è <b>Noticias en Madrid:</b><br>
      - Titular Madrid del d√≠a \$FECHA<br><br>

      üåç <b>Econom√≠a mundial:</b><br>
      - Titular internacional del d√≠a \$FECHA<br><br>

      üí∂ <b>Econom√≠a en Espa√±a:</b><br>
      - Titular econ√≥mico del d√≠a \$FECHA<br><br>

      üèóÔ∏è <b>Sector de la construcci√≥n:</b><br>
      - Titular del sector del d√≠a \$FECHA<br><br>

      üè¢ <b>Grupo ACS / Dragados S.A.:</b><br>
      - Titular corporativo del d√≠a \$FECHA<br><br>
      ]]></description>
      <pubDate>\$PUBDATE</pubDate>
    </item>
  </channel>
</rss>
EOF

      - name: Subir cambios al repositorio
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git add docs/noticias-diarias.xml.txt
          git commit -m "Actualizaci√≥n autom√°tica del feed \$FECHA" || echo "Sin cambios"
          git push
