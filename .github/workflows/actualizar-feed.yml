name: Actualizar noticias diarias

# Se ejecuta por cron (UTC). 07:00 UTC ‚âà 08:00 CET (Madrid) en horario est√°ndar.
on:
  schedule:
    - cron: "0 7 * * *"
  workflow_dispatch: {}

permissions:
  contents: write

jobs:
  actualizar-feed:
    runs-on: ubuntu-latest

    steps:
      - name: Clonar repositorio
        uses: actions/checkout@v4
        with:
          persist-credentials: true

      - name: Generar archivo XML actualizado (hora Madrid)
        run: |
          mkdir -p docs
          FECHA=$(TZ="Europe/Madrid" date +"%d/%m/%Y")
          PUBDATE=$(TZ="Europe/Madrid" date -R)

          cat > docs/noticias-diarias.xml.txt <<'EOF'
<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0">
  <channel>
    <title>Noticias Diarias - Espa√±a</title>
    <link>https://edekmm.github.io/Noticias-diarias/docs/noticias-diarias.xml.txt</link>
    <description>Noticias destacadas en Espa√±a, Madrid, econom√≠a mundial, econom√≠a espa√±ola, construcci√≥n y Grupo ACS / Dragados.</description>
    <language>es-es</language>

    <item>
      <title>Noticias del d√≠a ${FECHA}</title>
      <description><![CDATA[
      üá™üá∏ <b>Noticias en Espa√±a:</b><br>
      - Titular nacional del d√≠a ${FECHA}<br><br>

      üèôÔ∏è <b>Noticias en Madrid:</b><br>
      - Titular Madrid del d√≠a ${FECHA}<br><br>

      üåç <b>Econom√≠a mundial:</b><br>
      - Titular internacional del d√≠a ${FECHA}<br><br>

      üí∂ <b>Econom√≠a en Espa√±a:</b><br>
      - Titular econ√≥mico del d√≠a ${FECHA}<br><br>

      üèóÔ∏è <b>Sector de la construcci√≥n:</b><br>
      - Titular del sector del d√≠a ${FECHA}<br><br>

      üè¢ <b>Grupo ACS / Dragados S.A.:</b><br>
      - Titular corporativo del d√≠a ${FECHA}<br><br>
      ]]></description>
      <pubDate>${PUBDATE}</pubDate>
    </item>
  </channel>
</rss>
EOF

      - name: Comprobar cambios
        run: |
          git status --porcelain
          echo "---- listado de archivos en docs ----"
          ls -la docs

      - name: Commit & push (si hay cambios)
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git add docs/noticias-diarias.xml.txt
          git diff --staged --name-only || true
          if git diff --staged --quiet; then
            echo "No hay cambios para commitar."
          else
            git commit -m "Actualizaci√≥n autom√°tica del feed ${FECHA}"
            git push
          fi
